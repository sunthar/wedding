
<header class="navbar navbar-fixed-top navbar-inverse" id="top" role="banner">
  <div class="navbar-header">
    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a href="/admin" class="navbar-brand">
      Wedding Admin Page
    </a>
  </div>
  <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
    <ul class="nav navbar-nav">
      <!--
      <li class="active">
        <a href="#invitee_list" role="tab" data-toggle="tab">Invitee List</a>
      </li>
    -->
      <li class="navbar-actions">
        <!-- <button class="btn btn-success" id="import_spreadsheet">Import Spreadsheet</button> -->
        <a href="#" class="btn btn-success" id="import_spreadsheet">Import Spreadsheet</a>
      </li>
      <li class="navbar-actions">
        <a class="btn btn-warning" href="/admin/splash/export" target="_blank">Export Data</a>
      </li>
    </ul>
  </nav>
</header>
<div class="tab-content main_content">
  <div class="tab-pane active" id="invitee_list">
    <div class="section">
      <table class="table table-condensed table-bordered table-striped">
        <thead>
          <tr>
            <th></th>
            <th>first_name</th>
            <th>last_name</th>
            <th>full_name</th>
            <th>salutation</th>
            <th>email</th>
            <th>access_code</th>
            <th>phone</th>
            <th>street_address</th>
            <th>city</th>
            <th>state</th>
            <th>zip</th>
            <th>other_people</th>
            <th>invited_to_ceremony</th>
            <th>invited_to_reception</th>
            <th>invited_to_ca_reception</th>
            <th>invited_by</th>
            <th>invitee_batch_a</th>
            <th>invitee_batch_b</th>
            <th>rsvp_ceremony</th>
            <th>rsvp_reception</th>
            <th>rsvp_ca_reception</th>
            <th>rsvp_sent</th>
            <th>reminder_sent</th>
            <th>wedding_info_sent</th>
            <th>table_number</th>
            <th>save_date_sent</th>
            <th>physical_invitation_sent</th>
          </tr>
        </thead>
        <tbody id="user_table_body">
          <% @users.each do |user| %>
          <tr>
            <td><input type="checkbox"></td>
            <td><%= user.first_name %></td>
            <td><%= user.last_name %></td>
            <td><%= user.full_name %></td>
            <td><%= user.salutation %></td>
            <td><%= user.email %></td>
            <td><%= user.access_code %></td>
            <td><%= user.phone %></td>
            <td><%= user.street_address %></td>
            <td><%= user.city %></td>
            <td><%= user.state %></td>
            <td><%= user.zip %></td>
            <td><%= user.other_people.join(", ") %></td>
            <td><%= user.invited_to_ceremony %></td>
            <td><%= user.invited_to_reception %></td>
            <td><%= user.invited_to_ca_reception %></td>
            <td><%= user.invited_by %></td>
            <td><%= user.invitee_batch_a %></td>
            <td><%= user.invitee_batch_b %></td>
            <td><%= user.rsvp_ceremony %></td>
            <td><%= user.rsvp_reception %></td>
            <td><%= user.rsvp_ca_reception %></td>
            <td><%= user.rsvp_sent %></td>
            <td><%= user.reminder_sent %></td>
            <td><%= user.wedding_info_sent %></td>
            <td><%= user.table_number %></td>
            <td><%= user.save_date_sent %></td>
            <td><%= user.physical_invitation_sent %></td>
          </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
<script type="text/javascript">
  var fields = ["first_name", "last_name", "full_name", "salutation", "email", "access_code", "phone", "street_address", "city", "state", "zip", "other_people", "invited_to_ceremony", "invited_to_reception", "invited_to_ca_reception", "invited_by", "invitee_batch_a", "invitee_batch_b", "rsvp_ceremony", "rsvp_reception", "rsvp_ca_reception", "rsvp_sent", "reminder_sent", "wedding_info_sent", "table_number", "save_date_sent", "physical_invitation_sent"];
  // $(document).ajaxStart($.blockUI({ message: '<h1>Importing from google doc...</h1>' })).ajaxStop($.unblockUI);
  $(document).ready(function() {
    $("#import_spreadsheet").click(function() {
      $.ajax({
        url: '/admin/splash/import',
        type: 'GET',
        dataType: 'json',
        timeout: 15 * 60 * 1000, // 15 minute timeout
        success: function(data) {
          if (data && data.users) {
            var newRows = "";
            for (var i = 0; i < data.users.length; i++) {
              newRows += '<tr><td><input type="checkbox"></td>';
              for (var j = 0; j < fields.length; j++) {
                newRows += "<td>" + (data.users[i][fields[j]] ? data.users[i][fields[j]] : "") + "</td>"
              }
              newRows += "</tr>"
            }
            $("#user_table_body").html(newRows);
          }
          else {
            alert("Error: " + data);
          }
        },
        error: function(req, status, error) {
          console.log({req: req, status: status, error: error});
        }
      });
      return false;
    });
    // $("#export_data").click(function() {
    //   $.ajax({
    //     url: '/admin/splash/export',
    //     type: 'GET',
    //     dataType: 'file',
    //     timeout: 15 * 60 * 1000, // 15 minute timeout
    //     success: function(data) {
    //       console.log(data);
    //     },
    //     error: function(req, status, error) {
    //       console.log({req: req, status: status, error: error});
    //     }
    //   });
    // });
  });
</script>